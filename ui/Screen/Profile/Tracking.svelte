<script>
  import { fade } from "svelte/transition";
  import {
    EmptyState,
    Hoverable,
    List,
    ProjectList,
    Remote,
    TrackToggle,
    Urn,
  } from "../../DesignSystem/Component";

  import { tracked, fetchTracked } from "../../src/project.ts";
  import { FADE_DURATION } from "../../src/config.ts";
  import * as path from "../../src/path.ts";
  import * as modal from "../../src/modal.ts";
  import { Variant as IllustrationVariant } from "../../src/illustration.ts";

  fetchTracked();
  $: console.log($tracked);

  // const untracked = [
  //   {
  //     urn: "@hyndb5gs95gwtsf37tncz4ag3wqrg4ejw3qqga6x1srw9jp8jw59d6.git",
  //     metadata: {
  //       name: "snickers",
  //     },
  //   },
  //   {
  //     urn: "@hwd1yren6nte7ofh1sijz3tgc31cdmfb7zg7ya7gfgzwhhzgau8u13hkkjw.git",
  //     metadata: {
  //       name: "marsbar",
  //     },
  //   },
  //   {
  //     urn: "@hwd1yren6nte7ofh1sijz3tgc31cdmfb7zg7ya7gfgzwhhzgau8u13hkkjw.git",
  //     metadata: {
  //       name: "nougati",
  //     },
  //   },
  // ];

  const untracked = [];
</script>

<style>
  .container {
    margin: 0 auto;
    max-width: var(--content-max-width);
    min-width: var(--content-min-width);
  }

  .header {
    display: flex;
    margin: 1.5rem 3rem 0.5rem;
  }

  .undiscovered-project {
    padding: 1.5rem;
    flex: 1;
    min-height: 4.5rem;

    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .undiscovered-project:hover {
    background-color: var(--color-background);
  }

  .project-name {
    color: var(--color-foreground-level-6);
    padding-bottom: 0.375rem;
  }
</style>

<div class="container">
  <Remote store={tracked} let:data={projects}>
    {#if projects.length > 0}
      <ProjectList {projects} />
    {:else}
      <EmptyState
        text="You're not following any projects yet."
        illustration={IllustrationVariant.Horse}
        primaryActionText="Look for a project"
        on:primaryAction={() => {
          modal.toggle(path.search());
        }} />
    {/if}
  </Remote>

  {#if untracked.length}
    <div out:fade|local={{ duration: FADE_DURATION }}>
      <div class="header">
        <p class="typo-text-bold">Still lookingâ€¦&nbsp;</p>
        <p style="color: var(--color-foreground-level-6);">
          These projects haven't been found in your network yet or don't exist.
        </p>
      </div>
      <List items={untracked} let:item={project}>
        <Hoverable let:hovering={hover} style="flex: 1;">
          <div
            class="undiscovered-project"
            out:fade|local={{ duration: FADE_DURATION }}>
            <div>
              <p class="project-name typo-text-bold">{project.metadata.name}</p>
              <Urn urn={project.urn} showCopyOnlyOnHover />
            </div>
            {#if hover}
              <div transition:fade={{ duration: FADE_DURATION }}>
                <TrackToggle
                  tracking={true}
                  expanded
                  warning
                  on:untrack={() => console.log(`untrack ${project.urn}`)} />
              </div>
            {/if}
          </div>
        </Hoverable>
      </List>
    </div>
  {/if}
</div>
